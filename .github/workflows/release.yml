name: Build Package Release

on:
  push:
    tags:
      - 'v*'  # 推送 v 开头的标签时自动触发

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. 检出代码
      - uses: actions/checkout@v3
      
      # 2. 创建 package 目录（把你需要的文件放进去）
      - name: Prepare package
        run: |
          mkdir package
          # 复制主程序文件（根据你的项目修改）
          cp -r src/ package/ 2>/dev/null || true
          cp -r dist/ package/ 2>/dev/null || true
          cp -r lib/ package/ 2>/dev/null || true
          cp *.py package/ 2>/dev/null || true
          cp *.js package/ 2>/dev/null || true
          cp *.json package/ 2>/dev/null || true
          cp README.md package/ 2>/dev/null || true
          cp LICENSE package/ 2>/dev/null || true
          # 排除不需要的文件
          rm -rf package/node_modules package/.git
      
      # 3. 打包为 package.zip
      - name: Create package.zip
        run: |
          cd package
          zip -r ../package.zip .
          cd ..
          ls -lh package.zip
      
      # 4. 自动创建 Release 并上传 package.zip
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            package.zip
          generate_release_notes: true  # 自动生成更新日志
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
